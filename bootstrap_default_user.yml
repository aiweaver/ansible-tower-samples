---
# Add pdo user on remote machines
- hosts: all
  tasks:
  - name: Add remote users
    user: name=dmig group=sktair

# Generate SSK keys at the localhost for pde user
- hosts: localhost
  tasks:
  - name: Provision local dmig user
    user: name=dmig generate_ssh_key=yes ssh_key_bits=2048 ssh_key_file=.ssh/id_rsa

# Install public key into remote machine    
- hosts: all
  vars:
    authorized_key_list:
      - name: dmig
        authorized_key: user=dmig
                        key="{{ lookup('file', lookup('env','HOME') + '/.ssh/id_rsa.pub') }}"
                        state=present
  roles:
  - { role: GROG.authorized-key, become: yes }

# Add sudo privileges for pdo user
- hosts: all
  roles:
  - { role: GROG.sudo, become: yes }
