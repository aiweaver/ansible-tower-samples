---
# Add pdo user on remote machines
- hosts: all
  tasks:
  - name: Ensure group "sktaic" exists
    group:
      name: sktaic
      sudo: true
      state: present
  - name: Add SKT AIC Default User
    user:
      name: dmig
      sudo: true
      groups: wheel,sktaic
      shell: /bin/bash       # Defaults to /bin/bash
      system: no             # Defaults to no
      createhome: yes        # Defaults to yes

# Generate SSK keys at the localhost for pde user
- hosts: localhost
  tasks:
  - name: Provision local dmig user
    user: name=dmig generate_ssh_key=yes ssh_key_bits=2048 ssh_key_file=.ssh/id_rsa

# Install public key into remote machine    
- hosts: all
  vars:
    authorized_key_list:
      - name: dmig
        authorized_key: user=dmig
                        key="{{ lookup('file', lookup('env','HOME') + '/.ssh/id_rsa.pub') }}"
                        state=present
  roles:
  - { role: GROG.authorized-key, become: yes }

# Add sudo privileges for pdo user
- hosts: all
  roles:
  - { role: GROG.sudo, become: yes }
